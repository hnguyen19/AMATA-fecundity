---
output:
  bookdown::pdf_document2: 
  #  keep_tex: true
    toc: false
 # bookdown::html_document2: default
 # keep_tex: yes
 
---

```{r, include=FALSE}
library(emmeans)
library(here)
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, 
                       dev=c("png"),
                     # fig.width = 8, fig.height = 8, 
                      fig.pos = "H", table.placement = "H")
library(tidyverse)
library(dplyr)
library(magrittr)
library(MASS)
library(ggpmisc) # for function stat_poly_eq
library(broom) # for function tidy
library(nlme) #for function gls
library(kableExtra)
#source("functions.R")
library(fabricatr)  #for function split_quantile
options(digits = 6)
set.seed(505) #to make sure the prediction equation R2 come out the same when others run this file 
```

```{r, include=FALSE}
#fecundity18 <- read_csv(here("2 Data/Clean data/fecundity_18.csv"))

fecundity18 <- read_csv(here("2 Data/Clean data/fecundity_18.csv"), 
    col_types = cols(Biomass = col_number(), 
        Seed = col_number()), na = "empty")

fecundity18$Crop_ID <- factor(fecundity18$Crop_ID, levels = c("C2", "S2",
                                                                "C3", "S3", "O3",
                                                                "C4", "S4", "O4", "A4"))

fecundity18$label <- paste(as.character(fecundity18$Rotation), "year", sep="-")

fecundity18  <- fecundity18   %<>%
  mutate_at(c("Block","Crop_ID","Rotation","Corn_weed_management", "Plot", "Side", "bt"),funs(factor(.)))

# to scan the geometric means of number of seeds 
fecundity18_avg <- fecundity18%>%
  group_by(Plot,Side)%>%
  mutate(m_Seed = mean(log(Seed+1)))%>%
  slice(1)

```

## Individual female aboveground mass and fecundity {-}

```{r, include=FALSE}
fecundity18_b <- fecundity18[complete.cases(fecundity18$Biomass), ]
min(fecundity18_b$Biomass[fecundity18_b$Biomass > 0])

biomass.gls <- gls(log(Biomass + 0.005) ~ Block + Crop_ID + Corn_weed_management + Crop_ID:Corn_weed_management,
  correlation=corCompSymm(form= ~1 | bt), #identifies each treatment within block
  data=fecundity18_b)

fecundity18_s <- fecundity18[complete.cases(fecundity18$Seed), ]
min(fecundity18_s$Seed[fecundity18_s$Seed > 0])

seeds.gls <- gls(log(Seed + 1) ~ Block + Crop_ID + Corn_weed_management + Crop_ID:Corn_weed_management,
  correlation=corCompSymm(form= ~1 | bt), #identifies each treatment within block
  data=fecundity18_s)


biomass.gls_jt <- joint_tests(emmeans(biomass.gls, c("Crop_ID", "Corn_weed_management"))) 
biomass.gls_jt$`model term` <- gsub(":", " x ", biomass.gls_jt$`model term`)
biomass.gls_jt$`model term` <- gsub("_", " ", biomass.gls_jt$`model term`)
biomass.gls_df <- print(biomass.gls_jt, export = T)


seeds.gls_jt <- joint_tests(emmeans(seeds.gls, c("Crop_ID", "Corn_weed_management"))) 
seeds.gls_jt$`model term` <- gsub(":", " x ", seeds.gls_jt$`model term`)
seeds.gls_jt$`model term` <- gsub("_", " ", seeds.gls_jt$`model term`)

seeds.gls_df <- print(seeds.gls_jt, export = T)

biom_seed_gls <- cbind(biomass.gls_df$summary,seeds.gls_df$summary)

rownames(biom_seed_gls) <- NULL
```


```{r, include=FALSE}
#contrast(regrid(biom_emm_18))
f_biom_grid <- ref_grid(biomass.gls)
Rotation <- factor(c(rep("2-year", 2), rep("3-year", 3), rep("4-year", 4)),
                     levels = c("2-year", "3-year", "4-year"))

#f_biom_grid_rot_emm <- emmeans(f_biom_grid_rot , ~ Rotation | Corn_weed_management, type = "response")

#f_biom_rot_ct <- contrast(regrid(f_biom_grid_rot_emm),"pairwise", type = "response", infer = c(T,T))
#across rotation
#f_biom_rot_ct <- contrast(f_biom_grid_rot_emm,"pairwise", type = "response", infer = c(T,T)) %>% print(export = T)

Crop <- factor(c("corn", "soybean", "corn", "soybean", "oat", "corn", "soybean", "oat", "alfalfa"),
                     levels = c("soybean", "corn",  "oat", "alfalfa"))
```


```{r, include=F}
f_biom_grid_crop <- add_grouping(f_biom_grid , "Crop", "Crop_ID", Crop)
# crop crontrast, averaged over rotations
f_biom_crop <- emmeans(f_biom_grid_crop , ~ Crop | Corn_weed_management, infer = c(F,T),  type = "response") 
f_biom_crop_ct <- contrast(f_biom_crop , "pairwise", type = "response", infer = c(F,T)) %>% print(export = T)

## within rotation means  #herb effect was NS
f_biom_corn <-  emmeans(biomass.gls, ~ Crop_ID | Corn_weed_management, infer = c(F,T),  type = "response", at = list(Crop_ID = c("C2", "C3", "C4")))
f_biom_corn_ct <- contrast(f_biom_corn, "pairwise", type = "response", infer = c(F,T)) %>% print(export = T)

f_biom_soy <- emmeans(biomass.gls, c("Crop_ID", "Corn_weed_management"), infer = c(F,T),  type = "response", at = list(Crop_ID = c("S2", "S3", "S4"))) 

f_biom_soy_ct <- contrast(f_biom_soy, by = "Corn_weed_management" ,"pairwise", type = "response", infer = c(F,T)) %>% print(export = T)

f_biom_oat <- emmeans(biomass.gls, ~ Crop_ID| Corn_weed_management, infer = c(F,T),  type = "response", at = list(Crop_ID = c("O3", "O4")))

f_biom_oat_ct <- contrast(f_biom_oat, "pairwise", type = "response", infer = c(F,T)) %>% print(export = T)


f_biom_ct_conv <- rbind(f_biom_corn_ct$summary$`Corn_weed_management = conv`,
                        f_biom_soy_ct$summary$`Corn_weed_management = conv`,
                        f_biom_oat_ct$summary$`Corn_weed_management = conv`,
                   f_biom_crop_ct$summary$`Corn_weed_management = conv`)

f_biom_ct_conv_df <- as.data.frame(f_biom_ct_conv)

f_biom_ct_conv_df[,c(2:6)] <- sapply(f_biom_ct_conv_df[,c(2:6)],as.numeric)

f_biom_ct_conv_rounded <- f_biom_ct_conv_df %>%
  mutate(across(where(is.numeric), ~ as.numeric(sprintf('%.1f', .)))) %>%
#  mutate(across(where(is.numeric), as.character)) %>% #remove trailing zeros
  as_tibble # prevent adding trailing zeros later



f_biom_ct_low <- rbind(f_biom_corn_ct$summary$`Corn_weed_management = low`,
                        f_biom_soy_ct$summary$`Corn_weed_management = low`,
                        f_biom_oat_ct$summary$`Corn_weed_management = low`,
                   f_biom_crop_ct$summary$`Corn_weed_management = low`)

f_biom_ct_low_df <- as.data.frame(f_biom_ct_low)

f_biom_ct_low_df[,c(2:6)] <- sapply(f_biom_ct_low_df[,c(2:6)],as.numeric)

f_biom_ct_low_rounded <- f_biom_ct_low_df %>%
  mutate(across(where(is.numeric), ~ as.numeric(sprintf('%.1f', .)))) %>%
#  mutate(across(where(is.numeric), as.character)) %>% #remove trailing zeros
  as_tibble # prevent trailing zeros later


## Merge conventional (left) with low corn weed management (right) for individual biomass 
f_biom_ct <- cbind(f_biom_ct_conv_rounded[,-c(3:6)], f_biom_ct_low_rounded[,-c(3:6)])
         
row.names(f_biom_ct) <- NULL

```


```{r, include=FALSE}
f_seeds_grid <- ref_grid(seeds.gls)

Rotation <- factor(c(rep("2-year", 2), rep("3-year", 3), rep("4-year", 4)),
                     levels = c("2-year", "3-year", "4-year"))
f_seeds_grid_rot <- add_grouping(f_seeds_grid , "Rotation", "Crop_ID", Rotation)
f_seeds_grid_rot_emm <- emmeans(f_seeds_grid_rot , ~ Rotation | Corn_weed_management, type = "response")
f_seeds_rot_ct <- contrast(regrid(f_seeds_grid_rot_emm),"pairwise", type = "response", infer = c(F,T))

#across rotation
f_seeds_rot_ct <- contrast(f_seeds_grid_rot_emm,"pairwise", type = "response", infer = c(F,T)) %>% print(export = T)
Crop <- factor(c("corn", "soybean", "corn", "soybean", "oat", "corn", "soybean", "oat", "alfalfa"),
                     levels = c( "soybean", "corn",  "oat", "alfalfa"))
f_seeds_grid_crop <- add_grouping(f_seeds_grid , "Crop", "Crop_ID", Crop)
```


```{r, include=F}
## same crop across rotation means 
f_seeds_corn <-  emmeans(seeds.gls, ~ Crop_ID | Corn_weed_management, infer = c(F,T),  type = "response", at = list(Crop_ID = c( "C2", "C3", "C4")))
f_seeds_corn_ct <- contrast(f_seeds_corn, "pairwise", type = "response", infer = c(F,T)) %>% print(export = T)

f_seeds_soy <- emmeans(seeds.gls, c("Crop_ID", "Corn_weed_management"), infer = c(F,T),  type = "response", at = list(Crop_ID = c("S2", "S3", "S4"))) 

f_seeds_soy_ct <- contrast(f_seeds_soy, by = "Corn_weed_management" ,"pairwise", type = "response", infer = c(F,T)) %>% print(export = T)

f_seeds_oat <- emmeans(seeds.gls, ~ Crop_ID| Corn_weed_management, infer = c(F,T),  type = "response", at = list(Crop_ID = c("O3", "O4")))

f_seeds_oat_ct <- contrast(f_seeds_oat , "pairwise", type = "response", infer = c(F,T)) %>% print(export = T)


# crop crontrast, averaged over rotations
f_seeds_crop <- emmeans(f_seeds_grid_crop , ~ Crop | Corn_weed_management, infer = c(F,T),  type = "response") 
f_seeds_crop_ct <- contrast(f_seeds_crop , "pairwise", type = "response", infer = c(F,T)) %>% print(export = T)


# customized means, Corn_weed_management NS  with f_seeds_emm

f_seeds_ct_conv <- rbind(f_seeds_corn_ct$summary$`Corn_weed_management = conv`,
                         f_seeds_soy_ct$summary$`Corn_weed_management = conv`,
                         f_seeds_oat_ct$summary$`Corn_weed_management = conv`,
                   f_seeds_crop_ct$summary$`Corn_weed_management = conv`)

f_seeds_ct_conv_df <- as.data.frame(f_seeds_ct_conv)

f_seeds_ct_conv_df[,c(2:6)] <- sapply(f_seeds_ct_conv_df[,c(2:6)],as.numeric)

f_seeds_ct_conv_rounded <- f_seeds_ct_conv_df %>%
  mutate(across(where(is.numeric), ~ as.numeric(sprintf('%.1f', .)))) %>%
#  mutate(across(where(is.numeric), as.character)) %>% #remove trailing zeros
  as_tibble # prevent adding trailing zeros later

f_seeds_ct_low <- rbind(f_seeds_corn_ct$summary$`Corn_weed_management = low`,
                         f_seeds_soy_ct$summary$`Corn_weed_management = low`,
                         f_seeds_oat_ct$summary$`Corn_weed_management = low`,
                   f_seeds_crop_ct$summary$`Corn_weed_management = low`)

f_seeds_ct_low_df <- as.data.frame(f_seeds_ct_low)

f_seeds_ct_low_df[,c(2:6)] <- sapply(f_seeds_ct_low_df[,c(2:6)],as.numeric)

f_seeds_ct_low_rounded <- f_seeds_ct_low_df %>%
  mutate(across(where(is.numeric), ~ as.numeric(sprintf('%.1f', .)))) %>%
#  mutate(across(where(is.numeric), as.character)) %>% #remove trailing zeros
  as_tibble # prevent adding trailing zeros later

### Merge conventional (left) with low corn weed management (right) for individual fecundity 

f_seeds_ct <- cbind(f_seeds_ct_conv_rounded[,-c(3:6)], f_seeds_ct_low_rounded[,-c(3:6)])
         
row.names(f_seeds_ct) <- NULL
```

Individual female aboveground mass and fecundity were affected by rotation, crop species, and corn weed management (Table \@ref(tab:f-biom-fecund-ct)). Crop identity was more influential on female aboveground mass and fecundity than corn weed management regime, but the effect of crop identity differed between corn weed management regimes (Table \@ref(tab:ancova-jt)A and \@ref(tab:ancova-jt)B). Differences in relative female size and fecundity across rotation by herbicide treatments were attributed to the relative size and fecundity differences when the waterhemp populations grew in different crops' presence.  

Individual female aboveground mass was comparable in most pairwise comparison of the same crop species in different rotations, except S2 versus S3 (p-value = 0.0076) and S3 versus S4 (p-value = 0.0268) that followed corn under conventional weed management and C2 versus C3 (p-value = 0.0064) under low weed management. Averaged over rotations, individual female aboveground mass was 3.5- to 133.6-fold different across each pair of comparison (p-values < 0.05), except for corn under low weed management versus the succeeding oat (p-value = 0.9616).  

Individual fecundity was comparable in most pairwise comparison of the same crop species in different rotations, except S2 versus S3 (p-value = 0.001) and S3 versus S4 (p-value = 0.0046) that followed corn under conventional weed management and C2 versus C3 under low weed management (p-value = 0.0032), and O3 versus O4 that followed corn under low weed management (p-value = 0.0321). Averaged over rotations, individual fecundity was comparable between corn under low herbicide and oat in the same system (p-value = 0.4904) but was 6.3- to 6857.1-fold different in other pairs of comparison (p-values $\leq$ 0.0001). 

```{r f-biom-fecund-ct, echo=FALSE}

# Merge individual biomass (left) with individual fecundity (right), side by side
f_biom_seeds_ct <- cbind(f_biom_ct[-4], f_seeds_ct[-c(1,4)]) #left_joint requires unique names 

rownames(f_biom_seeds_ct) <- NULL 

colnames(f_biom_seeds_ct) <- c("Contrast",rep(c("ratio","p.value"),4))

f_biom_seeds_ct$Contrast <- gsub(" / ", " vs ", f_biom_seeds_ct$Contrast)


kbl(f_biom_seeds_ct, 
    longtable = F, booktabs = T, linesep = "", 
    caption = "Crop and rotation system effects on individual female aboveground mass and fecundity.") %>% 
    add_header_above(c(" " = 1, 
                       "Conventional herbicide \n corn weed management" = 2, 
                       "Low herbicide \n corn weed management" = 2,
                        "Conventional herbicide \n corn weed management" = 2, 
                       "Low herbicide \n corn weed management" = 2)) %>%
  add_header_above(c(" " = 1,
                    "Female individual aboveground mass" = 4, 
                    "Individual fecundity" = 4)) %>%
  column_spec(5, border_right = T) %>%
   pack_rows("(A) - Crop phase effects", 1,7) %>%
    pack_rows("(B) - Crop species effects", 8,13) %>%
  landscape()
```

## Effects of weed management regimes and rotations on female aboveground mass and fecundity relationship {-}   
  
Since the treatment effects were statistically significant for both female aboveground mass and fecundity (Table \@ref(tab:ancova-jt)), we proceeded with finding the slopes and intercepts for each linear regression of fecundity against biomass. Different slopes were specified by including interaction terms between the covariate and treatment factors. A regression slope for each treatment was necessary. That the training and testing sets' data points were well mingled indicated that the established equations were robust (Figure \@ref(fig:full-p)). The equations in Table \@ref(tab:ci-full) could predict waterhemp fecundity parsimoniously from dried aboveground mass using the relevant context of crop and crop management. The presented means and SEs for the estimated intercepts and slopes were established from the whole data set.  
 

```{r ancova-jt, echo = F}
### 18 means full compound symmetry mod

fecundity18_sb <- fecundity18[complete.cases(fecundity18$Seed, fecundity18$Biomass), ]

#log(fecundity18_sb$Biomass )

allcrops.biom.seed.gls <- gls(log(Seed+1) ~ Block + log(Biomass + 0.005) + Crop_ID + Corn_weed_management +
                      Crop_ID:Corn_weed_management +
                      Crop_ID:log(Biomass + 0.005) + Corn_weed_management:log(Biomass + 0.005) +
                      Crop_ID:Corn_weed_management:log(Biomass + 0.005),
  correlation=corCompSymm(form= ~1 | bt), #identifies each treatment within block
  data=fecundity18_sb)


allcrops.biom.seed.gls_jt <- joint_tests(emmeans(allcrops.biom.seed.gls , ~ Crop_ID * Corn_weed_management | Biomass, at = list(Biomass = c(-0.5, 1.3))))

#diff intercept, diff slope for each CropID:Corn_weed_management combination, to remove intercept for ease of view
allcrops.biom.seed.gls_d <- gls(log(Seed+1) ~ -1 +
                      Crop_ID:Corn_weed_management +
                      Crop_ID:Corn_weed_management:log(Biomass + 0.005),
  correlation=corCompSymm(form= ~1 | bt), #identifies each treatment within block
  data=fecundity18_sb)

#summary(allcrops.aov2)
#for ease of view 

allcrops.biom.seed.gls_jt$`model term` <- gsub(":", " x ", allcrops.biom.seed.gls_jt$`model term`)
allcrops.biom.seed.gls_jt$`model term` <- gsub("_", " ", allcrops.biom.seed.gls_jt$`model term`)

allcrops.biom.seed.gls_jt_df <- print(allcrops.biom.seed.gls_jt, export = T)


biom_seed_jt <- rbind(biomass.gls_df$summary,seeds.gls_df$summary, allcrops.biom.seed.gls_jt_df$summary)

rownames(biom_seed_jt) <- NULL

biom_seed_jt_df <- as.data.frame(biom_seed_jt)

biom_seed_jt_df[,2:4] <- sapply(biom_seed_jt_df[,2:4], as.numeric)

kbl(biom_seed_jt_df ,  booktabs = T, linesep = "", 
    longtable = F, digits = 1,
    col.names = c("Source of variation", "df1", "df2", "F.value", "p.value"),
    caption = "ANOVAs for effect of crop identity, corn weed management, and female aboveground mass on individual female aboveground mass (A), fecundity (B), and fecundity with aboveground mass covariate (C). Each combination of crop identity and corn weed management affected female aboveground mass and fecundity differently.") %>%
  pack_rows("(A) - Individual female aboveground mass. MSE = 2.02", 1,3) %>% 
  pack_rows("(B) - Individual fecundity. MSE = 3.43", 4,6) %>% 
  pack_rows("(C) - Individual fecundity with individual aboveground mass covariate. MSE = 1.01", 7,13) %>% 
  kable_styling(latex_options = c("scale_down"))

# <https://tex.stackexchange.com/questions/594324/how-to-replace-all-with-or-x-in-an-anova-table>
```  
```{r, include=FALSE}
# Compare MSE of models for seed production estimation from biomass, seed gls and biomass gls  

 mean(residuals(allcrops.biom.seed.gls)^2)  #1.01

 mean(residuals(seeds.gls)^2)  #3.42714

 mean(residuals(biomass.gls)^2)  #2.02063
```

```{r ci-full, echo=FALSE, fig.height= 24, fig.width= 16}
#full data set
fecundity18 <- read_csv(here("2 Data/Clean data/fecundity_18.csv"), 
    col_types = cols(Biomass = col_number(), 
        Seed = col_number()), na = "empty")

fecundity18$Crop_ID <- factor(fecundity18$Crop_ID, levels = c("C2", "S2",
                                                                "C3", "S3", "O3",
                                                                "C4", "S4", "O4", "A4"))
fecundity18  <- fecundity18   %<>%
  mutate_at(c("Block","Crop_ID","Rotation","Corn_weed_management", "Plot", "Side", "bt"),funs(factor(.)))


fecundity18_sb <- fecundity18[complete.cases(fecundity18$Seed, fecundity18$Biomass), ]

allcrops_18 <- fecundity18_sb %>%
  mutate(Tercile = split_quantile(Biomass, 4)) %>% #
  group_by(Tercile, Crop_ID, Corn_weed_management) %>% 
  mutate(m_Biomass = mean(Biomass),
         log_Biomass = log(Biomass),
         log_Seed = log(Seed + 1))

models_ci <- allcrops_18 %>% group_by(Crop_ID, Corn_weed_management) %>% 
           do(data.frame(tidy(lm(log(Seed+1) ~ log(Biomass + 0.005), data = .), conf.int=T )))

models_rsq <- allcrops_18 %>% group_by(Crop_ID, Corn_weed_management) %>% 
           do(data.frame(tidy(summary(lm(log(Seed+1) ~ log(Biomass + 0.005), data = .), conf.int=T )$r.squared)))
          
models_ci_df <- models_ci[,1:5] %>% 
  pivot_longer(cols=c(estimate, std.error)) %>% 
 pivot_wider(names_from = c(term, name), 
             values_from = value)

models_ci_rsq <- models_ci_df %>% left_join(models_rsq) 

kbl(models_ci_rsq , booktabs = T, longtable = F,
      col.names = c("Crop ID", "Corn \n weed management", "Estimate", "Std.error", "Estimate", "Std.error", " "),
          linesep = "",
          digits = 2, 
    caption = "Means and SEs for estimated linear regression of waterhemp fecundity (ln(seeds + 1)) versus biomass (ln(gram + 0.005)) indices intercepts and slopes, accompanied by the R$^2$ values of each equations.") %>%
  add_header_above(c("Effect" = 2 , "Intercept" = 2, "Slope" = 2, "R$^2$" = 1)) %>% 
  kable_styling(latex_options = c("scale_down"))

```

```{r, include=FALSE}
# write model_ci_df in Dissertation folder to use for other manuscript (link to be updated). 
#write.csv(models_ci_df, "~/Documents/Dissertation/Demographic_AMATA/Fecundity/fecund_eq.csv", row.names = F)
```

```{r all means split, echo=FALSE, message=F, warning=F} 
fecundity18 <- read_csv(here("2 Data/Clean data/fecundity_18.csv"), 
    col_types = cols(Biomass = col_number(), 
        Seed = col_number()), na = "empty")

fecundity18$Crop_ID <- factor(fecundity18$Crop_ID, levels = c("C2", "S2",
                                                                "C3", "S3", "O3",
                                                                "C4", "S4", "O4", "A4"))
fecundity18  <- fecundity18   %<>%
  mutate_at(c("Block","Crop_ID","Rotation","Corn_weed_management", "Plot", "Side", "bt"),funs(factor(.)))


fecundity18_sb <- fecundity18[complete.cases(fecundity18$Seed, fecundity18$Biomass), ]

allcrops_18 <- fecundity18_sb %>%
  mutate(Tercile = split_quantile(Biomass, 4)) %>% #
  group_by(Tercile, Crop_ID, Corn_weed_management) %>% 
  mutate(m_Biomass = mean(Biomass),
         log_Biomass = log(Biomass),
         log_Seed = log(Seed + 1))

allcrops_18_train <- allcrops_18 %>%
  sample_frac(0.8)

allcrops_18_test <- anti_join(allcrops_18, allcrops_18_train)



```





```{r, full-p, echo=FALSE, warning = FALSE, fig.width = 8, fig.height = 10, fig.cap = "The black and red dots are values from training and testing sets, respectively. Each regression line was plotted for one crop identity by herbicide treatment using the training set. Biomass index = ln(gram biomass + 0.005) and Fecundity index = ln(seeds + 1)"}

# Change the vertical panel text  
# https://stackoverflow.com/questions/3472980/how-to-change-facet-labels



ggplot(data = allcrops_18_train, aes(x = log_Biomass, y = log_Seed)) +
   geom_smooth(method = "lm", se=T, color="black", formula = y~x) +
   stat_poly_eq(formula = y~x, 
                aes(label = paste(..rr.label.., 
                                  sep = "~~~")),
                size = 6,
                parse = TRUE,
                label.y = 0.2,
                label.x = 0.9) +         
  facet_grid(Crop_ID ~  Corn_weed_management, 
             labeller = labeller(
        Corn_weed_management = c("conv" = "Corn weed management: conventional", "low" = "Corn weed management: low"))) +
    scale_y_continuous(limits = c(-3, 12),
                     expand = expansion(mult = c(0, 0.2))) +
  geom_point(size = 3) +
  geom_smooth(method = "lm") + 
    theme_bw()+
  theme(text=element_text(size=16),
        panel.margin.x=unit(1, "lines"))  +
    xlab("Biomass index") +   
    ylab("Fecundity index") +
  geom_point(data=allcrops_18_test, color = "red", size = 3)
```
